import{bn as Ee,bo as Te,m as me,bZ as Fe,s as W,bD as Be,ax as re,eH as Pe,b as E,o as r,c as L,a as p,D as U,C as N,u as e,t as P,l as w,B as c,d as k,r as Le,E as pe,j as F,Q as ge,K as ve,eI as Re,eJ as Oe,eK as Ue,aS as ie,aw as ze,eL as je,aF as ce,g as $,cJ as Me,eM as Ne,aO as xe,ae as Ve,w as oe,aa as Ke,h as _e,b0 as qe,bt as Ge,bK as de,eN as ue,A as Ze,v as Je,aB as Ye,x as Qe,aI as We,I as Xe,aP as fe,i as Q,eG as He,cu as et,H as se,eO as tt,L as ot,O as st,F as B,ag as at,U as X,G as ae,W as ye,a2 as nt,Z as he,a0 as be,X as lt,R as rt,b8 as it,$ as ct,Y as dt,k as ut,ci as ft,V as mt,cG as pt,bL as gt}from"./main-BIf-RZjU.js";import{v as vt}from"./loading-CfYh2QAa.js";import{u as _t,n as yt,o as ht,p as bt,k as Ct,q as wt,b as kt}from"./dropdown-menu-C1dIOVFB.js";import{u as $t,_ as Ce}from"./FormBase-CFvT8CJq.js";import{u as It,a as St,b as At,c as Dt,E as Et}from"./index-Ct_H50sQ.js";import{U as we}from"./event-BB_Ol6Sd.js";import{i as Tt,l as Ft,o as Bt,j as Pt,h as Lt,t as Rt,_ as Ot}from"./Loading-CT6fVT7q.js";import{E as Ut}from"./link-BI0n2Rx2.js";var zt="[object Map]",jt="[object Set]",Mt=Object.prototype,Nt=Mt.hasOwnProperty;function xt(o){if(o==null)return!0;if(Tt(o)&&(Ee(o)||typeof o=="string"||typeof o.splice=="function"||Ft(o)||Bt(o)||Te(o)))return!o.length;var g=Pt(o);if(g==zt||g==jt)return!o.size;if(Lt(o))return!Rt(o).length;for(var n in o)if(Nt.call(o,n))return!1;return!0}const ke=Symbol("dialogInjectionKey"),$e="dialog-fade",Ie=me({center:Boolean,alignCenter:Boolean,closeIcon:{type:Fe},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),Vt={close:()=>!0},Kt=W({name:"ElDialogContent"}),qt=W({...Kt,props:Ie,emits:Vt,setup(o,{expose:g}){const n=o,{t:d}=Be(),{Close:t}=Re,{dialogRef:y,headerRef:h,bodyId:m,ns:l,style:v}=re(ke),{focusTrapRef:S}=re(Pe),A=E(()=>[l.b(),l.is("fullscreen",n.fullscreen),l.is("draggable",n.draggable),l.is("align-center",n.alignCenter),{[l.m("center")]:n.center}]),T=Oe(S,y),f=E(()=>n.draggable),a=E(()=>n.overflow),{resetPosition:I,updatePosition:D}=It(y,h,f,a);return g({resetPosition:I,updatePosition:D}),(b,R)=>(r(),L("div",{ref:e(T),class:N(e(A)),style:ge(e(v)),tabindex:"-1"},[p("header",{ref_key:"headerRef",ref:h,class:N([e(l).e("header"),b.headerClass,{"show-close":b.showClose}])},[U(b.$slots,"header",{},()=>[p("span",{role:"heading","aria-level":b.ariaLevel,class:N(e(l).e("title"))},P(b.title),11,["aria-level"])]),b.showClose?(r(),L("button",{key:0,"aria-label":e(d)("el.dialog.close"),class:N(e(l).e("headerbtn")),type:"button",onClick:z=>b.$emit("close")},[w(e(pe),{class:N(e(l).e("close"))},{default:c(()=>[(r(),k(Le(b.closeIcon||e(t))))]),_:1},8,["class"])],10,["aria-label","onClick"])):F("v-if",!0)],2),p("div",{id:e(m),class:N([e(l).e("body"),b.bodyClass])},[U(b.$slots,"default")],10,["id"]),b.$slots.footer?(r(),L("footer",{key:0,class:N([e(l).e("footer"),b.footerClass])},[U(b.$slots,"footer")],2)):F("v-if",!0)],6))}});var Gt=ve(qt,[["__file","dialog-content.vue"]]);const Zt=me({...Ie,appendToBody:Boolean,appendTo:{type:Ue.to.type,default:"body"},beforeClose:{type:ie(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},modalPenetrable:Boolean,openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"},transition:{type:ie([String,Object]),default:$e}}),Jt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[we]:o=>ze(o),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},Yt=(o,g)=>{var n;const t=qe().emit,{nextZIndex:y}=je();let h="";const m=ce(),l=ce(),v=$(!1),S=$(!1),A=$(!1),T=$((n=o.zIndex)!=null?n:y());let f,a;const I=Me("namespace",Ne),D=E(()=>{const C={},_=`--${I.value}-dialog`;return o.fullscreen||(o.top&&(C[`${_}-margin-top`]=o.top),o.width&&(C[`${_}-width`]=xe(o.width))),C}),b=E(()=>o.alignCenter?{display:"flex"}:{}),R=E(()=>{const C={name:o.transition,onAfterEnter:z,onBeforeLeave:O,onAfterLeave:x};if(Ve(o.transition)){const _={...o.transition},G=(q,te)=>J=>{Ge(q)?q.forEach(Y=>{de(Y)&&Y(J)}):de(q)&&q(J),te()};return _.onAfterEnter=G(_.onAfterEnter,z),_.onBeforeLeave=G(_.onBeforeLeave,O),_.onAfterLeave=G(_.onAfterLeave,x),_.name||(_.name=$e),_}return C});function z(){t("opened")}function x(){t("closed"),t(we,!1),o.destroyOnClose&&(A.value=!1)}function O(){t("close")}function j(){a==null||a(),f==null||f(),o.openDelay&&o.openDelay>0?{stop:f}=ue(()=>s(),o.openDelay):s()}function V(){f==null||f(),a==null||a(),o.closeDelay&&o.closeDelay>0?{stop:a}=ue(()=>M(),o.closeDelay):M()}function u(){function C(_){_||(S.value=!0,v.value=!1)}o.beforeClose?o.beforeClose(C):V()}function i(){o.closeOnClickModal&&u()}function s(){Ze&&(v.value=!0)}function M(){v.value=!1}function K(){t("openAutoFocus")}function Z(){t("closeAutoFocus")}function H(C){var _;((_=C.detail)==null?void 0:_.focusReason)==="pointer"&&C.preventDefault()}o.lockScroll&&St(v);function ee(){o.closeOnPressEscape&&u()}return oe(()=>o.zIndex,()=>{var C;T.value=(C=o.zIndex)!=null?C:y()}),oe(()=>o.modelValue,C=>{var _;C?(S.value=!1,j(),A.value=!0,T.value=(_=o.zIndex)!=null?_:y(),Ke(()=>{t("open"),g.value&&(g.value.parentElement.scrollTop=0,g.value.parentElement.scrollLeft=0,g.value.scrollTop=0)})):v.value&&V()}),oe(()=>o.fullscreen,C=>{g.value&&(C?(h=g.value.style.transform,g.value.style.transform=""):g.value.style.transform=h)}),_e(()=>{o.modelValue&&(v.value=!0,A.value=!0,j())}),{afterEnter:z,afterLeave:x,beforeLeave:O,handleClose:u,onModalClick:i,close:V,doClose:M,onOpenAutoFocus:K,onCloseAutoFocus:Z,onCloseRequested:ee,onFocusoutPrevented:H,titleId:m,bodyId:l,closed:S,style:D,overlayDialogStyle:b,rendered:A,visible:v,zIndex:T,transitionConfig:R}},Qt=W({name:"ElDialog",inheritAttrs:!1}),Wt=W({...Qt,props:Zt,emits:Jt,setup(o,{expose:g}){const n=o,d=Je();Ye({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},E(()=>!!d.title));const t=Qe("dialog"),y=$(),h=$(),m=$(),{visible:l,titleId:v,bodyId:S,style:A,overlayDialogStyle:T,rendered:f,transitionConfig:a,zIndex:I,handleClose:D,onModalClick:b,onOpenAutoFocus:R,onCloseAutoFocus:z,onCloseRequested:x,onFocusoutPrevented:O}=Yt(n,y);We(ke,{dialogRef:y,headerRef:h,bodyId:S,ns:t,rendered:f,style:A});const j=Dt(b),V=E(()=>n.draggable&&!n.fullscreen),u=E(()=>n.modalPenetrable&&!n.modal&&!n.fullscreen);return g({visible:l,dialogContentRef:m,resetPosition:()=>{var s;(s=m.value)==null||s.resetPosition()},handleClose:D}),(s,M)=>(r(),k(e(tt),{to:s.appendTo,disabled:s.appendTo!=="body"?!1:!s.appendToBody},{default:c(()=>[w(Xe,fe(e(a),{persisted:""}),{default:c(()=>{var K;return[Q(w(e(At),{"custom-mask-event":"",mask:s.modal,"overlay-class":[(K=s.modalClass)!=null?K:"",`${e(t).namespace.value}-modal-dialog`,e(t).is("penetrable",e(u))],"z-index":e(I)},{default:c(()=>[p("div",{role:"dialog","aria-modal":"true","aria-label":s.title||void 0,"aria-labelledby":s.title?void 0:e(v),"aria-describedby":e(S),class:N(`${e(t).namespace.value}-overlay-dialog`),style:ge(e(T)),onClick:e(j).onClick,onMousedown:e(j).onMousedown,onMouseup:e(j).onMouseup},[w(e(He),{loop:"",trapped:e(l),"focus-start-el":"container",onFocusAfterTrapped:e(R),onFocusAfterReleased:e(z),onFocusoutPrevented:e(O),onReleaseRequested:e(x)},{default:c(()=>[e(f)?(r(),k(Gt,fe({key:0,ref_key:"dialogContentRef",ref:m},s.$attrs,{center:s.center,"align-center":s.alignCenter,"close-icon":s.closeIcon,draggable:e(V),overflow:s.overflow,fullscreen:s.fullscreen,"header-class":s.headerClass,"body-class":s.bodyClass,"footer-class":s.footerClass,"show-close":s.showClose,title:s.title,"aria-level":s.headerAriaLevel,onClose:e(D)}),et({header:c(()=>[s.$slots.title?U(s.$slots,"title",{key:1}):U(s.$slots,"header",{key:0,close:e(D),titleId:e(v),titleClass:e(t).e("title")})]),default:c(()=>[U(s.$slots,"default")]),_:2},[s.$slots.footer?{name:"footer",fn:c(()=>[U(s.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):F("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[se,e(l)]])]}),_:3},16)]),_:3},8,["to","disabled"]))}});var Xt=ve(Wt,[["__file","dialog.vue"]]);const Ht=ot(Xt),eo={key:1},to={__name:"ActionsModal",props:{actionsUrl:String},emits:["close"],setup(o,{emit:g}){const n=o,d=$(!1);let t=st({name:"Action",class:"",blueprint:null,dangerous:!1,redirect:!1});$(0);const y=$(),h=$([]),m=$(!1),l=E(()=>({class:t.class,selected:h.value})),v=E(()=>t.dangerous?"danger":"primary"),S=E(()=>t.action_button??"Run Action");Invicta.on("show-action-modal",f=>{console.log("opening the action modal",f);let a=f.selected[0];h.value=f.selected||[],t=f.action,m.value=f.action.blueprint!==null,y.value=`action.${t.class}.${a??t.type}`,d.value=!0}),E(()=>({blueprint:t.blueprint}));const A=()=>{if(m.value)$t(y.value).submit();else{let f={...l.value,fields:[],validation:[]};if(t.redirect){const a=l.value.selected.map(D=>`selected[]=${D}`);let I=`${t.redirect}?class=${l.value.class}&${a.join("&")}`;window.open(I,"_blank")}else Invicta.fetch.post(n.actionsUrl,f).then(({data:a})=>{Invicta.message(a.message),Invicta.emit("refresh-resource")});d.value=!1}},T=()=>{Invicta.emit("refresh-resource"),d.value=!1};return(f,a)=>{const I=Ce,D=X,b=Ht;return r(),k(b,{modelValue:e(d),"onUpdate:modelValue":a[1]||(a[1]=R=>at(d)?d.value=R:null),title:e(t).name,width:"30%"},{footer:c(()=>[w(D,{onClick:a[0]||(a[0]=R=>d.value=!1)},{default:c(()=>a[2]||(a[2]=[B("Cancel",-1)])),_:1,__:[2]}),w(D,{type:e(v),onClick:A},{default:c(()=>[B(P(e(S)),1)]),_:1},8,["type"])]),default:c(()=>[e(m)?(r(),k(I,{key:e(y),headless:!0,"form-id":e(y),resource:e(t),"action-url":o.actionsUrl,params:e(l),"save-tabs":!1,onSubmitted:T},null,8,["form-id","resource","action-url","params"])):(r(),L("div",eo,"Are you sure you want to run this action?"))]),_:1},8,["modelValue","title"])}}},oo={__name:"Actions",props:{name:{type:String,default:"Actions"},global:{type:Boolean,default:!1},actions:Array,selected:{type:Array,default:[]}},setup(o){const g=o,n=d=>{console.log("have command",d);let t={action:d,selected:g.selected.length?g.selected:[]};Invicta.emit("action-called",t)};return(d,t)=>{const y=pe,h=X,m=he,l=be;return r(),k(l,{trigger:"click",onCommand:n,class:"mr-2"},{dropdown:c(()=>[(r(!0),L(ae,null,ye(o.actions,v=>(r(),k(m,{command:v},{default:c(()=>[B(P(v.name),1)]),_:2},1032,["command"]))),256))]),default:c(()=>[w(h,{size:"large"},{default:c(()=>[B(P(o.name)+" ",1),w(y,{class:"el-icon--right"},{default:c(()=>[w(e(nt))]),_:1})]),_:1})]),_:1})}}},so={class:"mx-2"},ao={__name:"LocaleSwitch",props:{locales:Object},setup(o){const g=o,{locales:n}=g,d=Invicta.getConfig("currentLocale"),t=n[d].hasOwnProperty("flag"),y=h=>{let m=new URL(window.location.href);m.searchParams.set("locale",h),window.location.href=m.toString()};return(h,m)=>{const l=rt,v=it,S=X,A=he,T=ct,f=be;return r(),k(f,{class:"mr-4",onCommand:y},{dropdown:c(()=>[w(T,null,{default:c(()=>[(r(!0),L(ae,null,ye(e(n),a=>(r(),k(A,{key:a.iso,command:a.iso,disabled:e(d)==a.iso},{default:c(()=>[B(P(a.name),1)]),_:2},1032,["command","disabled"]))),128))]),_:1})]),default:c(()=>[w(S,{size:"small",text:"",type:"info"},{default:c(()=>[w(l,{icon:e(lt),width:15},null,8,["icon"]),m[0]||(m[0]=B()),p("span",so,P(e(n)[e(d)].name),1),e(t)?(r(),k(v,{key:0,country:e(n)[e(d)].flag},null,8,["country"])):F("",!0)]),_:1,__:[0]})]),_:1})}}},no={key:0,class:"py-6 px-10"},lo={class:"flex items-end justify-start mb-4"},ro={class:"flex-auto mr-4"},io={class:"mb-1"},co={class:"max-w-sm"},uo={class:"ml-auto flex items-center"},fo={class:"el-card"},mo={class:"flex items-center justify-start p-3"},po={class:"mr-2 leading-none"},go={class:"ml-auto leading-none flex items-center"},vo={key:0,class:"bg-slate-100 px-3 py-2 flex items-center justify-between"},_o={class:"flex items-center leading-none"},yo={class:"mr-2 text-sm"},ho={class:"ml-auto flex items-center"},bo={class:"ml-3",title:"Delete Selected"},Co={class:"flex items-center justify-between p-3 mt-2"},wo={key:1,class:"p-10 flex items-center justify-center"},ko={class:"px-8 pb-4 pt-12 w-full"},Po={__name:"IndexBase",props:{handle:String},setup(o){const g=dt(),n=ut(),d=o,t=_t(d.handle);t.initIndex(n);const y=$(),h=$(!1),m=$(),l=$(),v=$(""),S=$({}),A=`api${n.path}/actions`;_e(()=>{Invicta.on("action-called",T)}),ft(()=>{Invicta.off("action-called",T)});const T=({action:u,selected:i})=>{if(u.modal)Invicta.emit("show-action-modal",{action:u,selected:i});else{let s=null;S.value={class:u.class},i.length&&(S.value.selected=i,s=i[0]),Invicta.fetch.get(`${A}/blueprint/${s}`,{params:{class:u.class}}).then(M=>{m.value=`${d.handle}.${s}.${u.class}`,l.value=M,v.value=A,h.value=!0})}},f=u=>{if(t.static.settings.indexEdit){let i=`api${n.path}/${u}`;S.value={},Invicta.fetch.get(`${i}/edit`).then(s=>{m.value=`${d.handle}.${s.item.id}`,l.value=s,v.value=i,h.value=!0})}else g.push({name:"resourceEdit",params:{handle:d.handle,id:u}})},a=$(!1),I=$([]),D=u=>{a.value=!1,I.value=u.map(i=>i.id)},b=async()=>{let u=await t.selectAll();a.value=!0,I.value=u.data},R=E(()=>`${a.value?t.data.total:I.value.length} records selected`),z=()=>{a.value=!1,y.value.clearSelection(),I.value=[]},x=E(()=>!xt(t.data.activeFilters)),O=u=>{Et.confirm("This action will permanently delete records from database. Are you sure you want to continue?","Deleting",{confirmButtonText:"Delete",cancelButtonText:"Cancel",confirmButtonClass:"el-button--danger"}).then(()=>{Invicta.fetch.delete(`api${n.path}`,{selected:u}).then(i=>{Invicta.message(i.message),t.getResource()})}).catch(i=>{console.log("cancel",i)})},j=()=>{I.value.length&&O(I.value)},V=u=>{u.action=="close"&&(h.value=!1),t.getResource()};return Invicta.on("refresh-resource",()=>{t.getResource()}),(u,i)=>{var ne,le;const s=yt,M=ao,K=oo,Z=X,H=mt("router-link"),ee=ht,C=Ut,_=bt,G=Ct,q=wt,te=Ot,J=to,Y=Ce,Se=gt,Ae=kt,De=vt;return r(),L(ae,null,[e(t).static.settings?(r(),L("div",no,[p("div",lo,[p("div",ro,[p("h1",io,P(e(t).static.settings.title),1),p("div",co,[(r(),k(s,{currentSearch:e(n).query.search,key:o.handle,onUpdate:e(t).setSearch},null,8,["currentSearch","onUpdate"]))])]),p("div",uo,[e(t).static.settings.locales?(r(),k(M,{key:0,locales:e(t).static.settings.locales},null,8,["locales"])):F("",!0),(ne=e(t).static.actions)!=null&&ne.global?(r(),k(K,{key:1,global:!0,actions:e(t).static.actions.global,name:"Resource Actions"},null,8,["actions"])):F("",!0),U(u.$slots,"actions",{settings:e(t).static.settings},()=>[Q(w(H,{to:{name:"resourceCreate"}},{default:c(()=>[w(Z,{type:"primary",size:"large"},{default:c(()=>i[1]||(i[1]=[B("Create new",-1)])),_:1,__:[1]})]),_:1},512),[[se,e(t).static.settings.canCreate]])])])]),p("div",fo,[p("div",mo,[p("div",po,[i[2]||(i[2]=B(" Total: ",-1)),p("strong",null,P(e(t).data.total),1)]),p("div",null,[w(ee,{badges:e(t).data.filterBadges},null,8,["badges"])]),p("div",go,[e(x)?(r(),k(C,{key:0,onClick:e(t).clearFilters,underline:"never",type:"danger",class:"mr-2"},{default:c(()=>i[3]||(i[3]=[B("Clear all filters",-1)])),_:1,__:[3]},8,["onClick"])):F("",!0),e(t).static.filters?(r(),k(_,{key:1,"resource-handle":o.handle,filters:e(t).static.filters,"active-filters":e(t).data.activeFilters},null,8,["resource-handle","filters","active-filters"])):F("",!0)])]),e(I).length?(r(),L("div",vo,[p("div",_o,[p("span",yo,P(e(R)),1),e(a)?F("",!0):(r(),k(C,{key:0,type:"primary",underline:"never",onClick:b,class:"mr-2"},{default:c(()=>[B("Select all "+P(e(t).data.total),1)]),_:1})),w(C,{underline:"never",type:"info",onClick:z},{default:c(()=>i[4]||(i[4]=[B("Deselect all",-1)])),_:1,__:[4]})]),p("div",ho,[(le=e(t).static.actions)!=null&&le.bulk?(r(),k(K,{key:0,name:"Bulk Actions",actions:e(t).static.actions.bulk,selected:e(I),"selected-all":e(a)},null,8,["actions","selected","selected-all"])):F("",!0),Q(p("div",bo,[w(Z,{icon:e(pt),onClick:j},null,8,["icon"])],512),[[se,e(t).static.settings.canDelete]])])])):F("",!0),U(u.$slots,"default",{resource:e(t).data.resourceData,settings:e(t).static.settings,handleEdit:f,handleSelect:D,handleDelete:O},()=>[Q((r(),k(G,{ref_key:"resourceTableRef",ref:y,key:o.handle,"resource-handle":o.handle,data:e(t).data.resourceData,"table-props":e(t).static.settings.table,columns:e(t).static.settings.columns,"can-edit":e(t).static.settings.canEdit,"can-delete":e(t).static.settings.canDelete,"has-detail":e(t).static.settings.hasDetail,onSelect:D,onEdit:f,onDelete:O},null,8,["resource-handle","data","table-props","columns","can-edit","can-delete","has-detail"])),[[De,e(t).data.loading]])]),p("div",Co,[p("div",null,[i[5]||(i[5]=B(" Total: ",-1)),p("strong",null,P(e(t).data.total),1)]),w(q,{background:"",size:"small",layout:"jumper, prev, pager, next, sizes","current-page":e(t).data.currentPage,"page-size":e(t).data.perPage,total:e(t).data.total,"onUpdate:pageSize":e(t).setPageSize,"onUpdate:currentPage":e(t).setPage},null,8,["current-page","page-size","total","onUpdate:pageSize","onUpdate:currentPage"])])])])):(r(),L("div",wo,[w(te)])),w(J,{"actions-url":A}),e(h)?(r(),k(Ae,{key:2,onClose:i[0]||(i[0]=$o=>h.value=!1),style:{width:"80%"}},{default:c(()=>[w(Se,null,{default:c(()=>[p("div",ko,[(r(),k(Y,{class:"mx-auto",key:e(m),"form-id":e(m),resource:e(l),"action-url":e(v),params:e(S),"post-submit-actions":["close","edit"],onSubmitted:V},null,8,["form-id","resource","action-url","params"]))])]),_:1})]),_:1})):F("",!0)],64)}}};export{Po as _};

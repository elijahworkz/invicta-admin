import{bn as Se,bo as Ie,m as ae,bZ as De,s as Z,bD as Ae,ax as te,eH as Ee,b as T,o as i,c as z,a as p,D as U,C as M,u as e,t as L,l as b,B as c,d as C,r as Fe,E as le,j as B,Q as ne,K as re,eI as Te,eJ as Be,eK as Pe,aS as Re,aw as Le,eL as ze,aF as oe,g as w,d0 as Ue,eM as Oe,aO as Me,w as Y,aa as je,h as ie,b0 as xe,eN as se,A as Ne,v as Ve,aB as Ke,x as qe,aI as Ge,I as Ze,i as G,eG as He,aP as Je,cu as Ye,H as Q,eO as Qe,L as We,O as Xe,F as P,ag as et,U as H,G as W,W as ce,a2 as tt,Z as de,a0 as ue,X as ot,R as st,b8 as at,$ as lt,Y as nt,k as rt,ci as it,V as ct,cG as dt,bL as ut}from"./main-DL69bNQp.js";import{v as ft}from"./loading-DWQTIUpt.js";import{u as mt,n as pt,o as gt,p as vt,k as _t,q as yt,b as ht}from"./dropdown-menu-BGEQdedM.js";import{u as bt,_ as fe}from"./FormBase-C6kPN3Yp.js";import{u as Ct,a as wt,b as kt,c as $t,E as St}from"./index-CTkQEo01.js";import{U as me}from"./event-BB_Ol6Sd.js";import{i as It,l as Dt,o as At,j as Et,h as Ft,t as Tt,_ as Bt}from"./Loading-D04WBFpf.js";import{E as Pt}from"./link-iUZNf2-L.js";var Rt="[object Map]",Lt="[object Set]",zt=Object.prototype,Ut=zt.hasOwnProperty;function Ot(o){if(o==null)return!0;if(It(o)&&(Se(o)||typeof o=="string"||typeof o.splice=="function"||Dt(o)||At(o)||Ie(o)))return!o.length;var g=Et(o);if(g==Rt||g==Lt)return!o.size;if(Ft(o))return!Tt(o).length;for(var n in o)if(Ut.call(o,n))return!1;return!0}const pe=Symbol("dialogInjectionKey"),ge=ae({center:Boolean,alignCenter:Boolean,closeIcon:{type:De},draggable:Boolean,overflow:Boolean,fullscreen:Boolean,headerClass:String,bodyClass:String,footerClass:String,showClose:{type:Boolean,default:!0},title:{type:String,default:""},ariaLevel:{type:String,default:"2"}}),Mt={close:()=>!0},jt=Z({name:"ElDialogContent"}),xt=Z({...jt,props:ge,emits:Mt,setup(o,{expose:g}){const n=o,{t:d}=Ae(),{Close:t}=Te,{dialogRef:_,headerRef:y,bodyId:m,ns:r,style:v}=te(pe),{focusTrapRef:$}=te(Ee),I=T(()=>[r.b(),r.is("fullscreen",n.fullscreen),r.is("draggable",n.draggable),r.is("align-center",n.alignCenter),{[r.m("center")]:n.center}]),D=Be($,_),f=T(()=>n.draggable),s=T(()=>n.overflow),{resetPosition:k,updatePosition:E}=Ct(_,y,f,s);return g({resetPosition:k,updatePosition:E}),(h,R)=>(i(),z("div",{ref:e(D),class:M(e(I)),style:ne(e(v)),tabindex:"-1"},[p("header",{ref_key:"headerRef",ref:y,class:M([e(r).e("header"),h.headerClass,{"show-close":h.showClose}])},[U(h.$slots,"header",{},()=>[p("span",{role:"heading","aria-level":h.ariaLevel,class:M(e(r).e("title"))},L(h.title),11,["aria-level"])]),h.showClose?(i(),z("button",{key:0,"aria-label":e(d)("el.dialog.close"),class:M(e(r).e("headerbtn")),type:"button",onClick:N=>h.$emit("close")},[b(e(le),{class:M(e(r).e("close"))},{default:c(()=>[(i(),C(Fe(h.closeIcon||e(t))))]),_:1},8,["class"])],10,["aria-label","onClick"])):B("v-if",!0)],2),p("div",{id:e(m),class:M([e(r).e("body"),h.bodyClass])},[U(h.$slots,"default")],10,["id"]),h.$slots.footer?(i(),z("footer",{key:0,class:M([e(r).e("footer"),h.footerClass])},[U(h.$slots,"footer")],2)):B("v-if",!0)],6))}});var Nt=re(xt,[["__file","dialog-content.vue"]]);const Vt=ae({...ge,appendToBody:Boolean,appendTo:{type:Pe.to.type,default:"body"},beforeClose:{type:Re(Function)},destroyOnClose:Boolean,closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},modal:{type:Boolean,default:!0},openDelay:{type:Number,default:0},closeDelay:{type:Number,default:0},top:{type:String},modelValue:Boolean,modalClass:String,headerClass:String,bodyClass:String,footerClass:String,width:{type:[String,Number]},zIndex:{type:Number},trapFocus:Boolean,headerAriaLevel:{type:String,default:"2"}}),Kt={open:()=>!0,opened:()=>!0,close:()=>!0,closed:()=>!0,[me]:o=>Le(o),openAutoFocus:()=>!0,closeAutoFocus:()=>!0},qt=(o,g)=>{var n;const t=xe().emit,{nextZIndex:_}=ze();let y="";const m=oe(),r=oe(),v=w(!1),$=w(!1),I=w(!1),D=w((n=o.zIndex)!=null?n:_());let f,s;const k=Ue("namespace",Oe),E=T(()=>{const S={},A=`--${k.value}-dialog`;return o.fullscreen||(o.top&&(S[`${A}-margin-top`]=o.top),o.width&&(S[`${A}-width`]=Me(o.width))),S}),h=T(()=>o.alignCenter?{display:"flex"}:{});function R(){t("opened")}function N(){t("closed"),t(me,!1),o.destroyOnClose&&(I.value=!1)}function V(){t("close")}function O(){s==null||s(),f==null||f(),o.openDelay&&o.openDelay>0?{stop:f}=se(()=>l(),o.openDelay):l()}function j(){f==null||f(),s==null||s(),o.closeDelay&&o.closeDelay>0?{stop:s}=se(()=>F(),o.closeDelay):F()}function x(){function S(A){A||($.value=!0,v.value=!1)}o.beforeClose?o.beforeClose(S):j()}function u(){o.closeOnClickModal&&x()}function l(){Ne&&(v.value=!0)}function F(){v.value=!1}function a(){t("openAutoFocus")}function K(){t("closeAutoFocus")}function q(S){var A;((A=S.detail)==null?void 0:A.focusReason)==="pointer"&&S.preventDefault()}o.lockScroll&&wt(v);function J(){o.closeOnPressEscape&&x()}return Y(()=>o.zIndex,()=>{var S;D.value=(S=o.zIndex)!=null?S:_()}),Y(()=>o.modelValue,S=>{var A;S?($.value=!1,O(),I.value=!0,D.value=(A=o.zIndex)!=null?A:_(),je(()=>{t("open"),g.value&&(g.value.parentElement.scrollTop=0,g.value.parentElement.scrollLeft=0,g.value.scrollTop=0)})):v.value&&j()}),Y(()=>o.fullscreen,S=>{g.value&&(S?(y=g.value.style.transform,g.value.style.transform=""):g.value.style.transform=y)}),ie(()=>{o.modelValue&&(v.value=!0,I.value=!0,O())}),{afterEnter:R,afterLeave:N,beforeLeave:V,handleClose:x,onModalClick:u,close:j,doClose:F,onOpenAutoFocus:a,onCloseAutoFocus:K,onCloseRequested:J,onFocusoutPrevented:q,titleId:m,bodyId:r,closed:$,style:E,overlayDialogStyle:h,rendered:I,visible:v,zIndex:D}},Gt=Z({name:"ElDialog",inheritAttrs:!1}),Zt=Z({...Gt,props:Vt,emits:Kt,setup(o,{expose:g}){const n=o,d=Ve();Ke({scope:"el-dialog",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/dialog.html#slots"},T(()=>!!d.title));const t=qe("dialog"),_=w(),y=w(),m=w(),{visible:r,titleId:v,bodyId:$,style:I,overlayDialogStyle:D,rendered:f,zIndex:s,afterEnter:k,afterLeave:E,beforeLeave:h,handleClose:R,onModalClick:N,onOpenAutoFocus:V,onCloseAutoFocus:O,onCloseRequested:j,onFocusoutPrevented:x}=qt(n,_);Ge(pe,{dialogRef:_,headerRef:y,bodyId:$,ns:t,rendered:f,style:I});const u=$t(N),l=T(()=>n.draggable&&!n.fullscreen);return g({visible:r,dialogContentRef:m,resetPosition:()=>{var a;(a=m.value)==null||a.resetPosition()},handleClose:R}),(a,K)=>(i(),C(e(Qe),{to:a.appendTo,disabled:a.appendTo!=="body"?!1:!a.appendToBody},{default:c(()=>[b(Ze,{name:"dialog-fade",onAfterEnter:e(k),onAfterLeave:e(E),onBeforeLeave:e(h),persisted:""},{default:c(()=>[G(b(e(kt),{"custom-mask-event":"",mask:a.modal,"overlay-class":a.modalClass,"z-index":e(s)},{default:c(()=>[p("div",{role:"dialog","aria-modal":"true","aria-label":a.title||void 0,"aria-labelledby":a.title?void 0:e(v),"aria-describedby":e($),class:M(`${e(t).namespace.value}-overlay-dialog`),style:ne(e(D)),onClick:e(u).onClick,onMousedown:e(u).onMousedown,onMouseup:e(u).onMouseup},[b(e(He),{loop:"",trapped:e(r),"focus-start-el":"container",onFocusAfterTrapped:e(V),onFocusAfterReleased:e(O),onFocusoutPrevented:e(x),onReleaseRequested:e(j)},{default:c(()=>[e(f)?(i(),C(Nt,Je({key:0,ref_key:"dialogContentRef",ref:m},a.$attrs,{center:a.center,"align-center":a.alignCenter,"close-icon":a.closeIcon,draggable:e(l),overflow:a.overflow,fullscreen:a.fullscreen,"header-class":a.headerClass,"body-class":a.bodyClass,"footer-class":a.footerClass,"show-close":a.showClose,title:a.title,"aria-level":a.headerAriaLevel,onClose:e(R)}),Ye({header:c(()=>[a.$slots.title?U(a.$slots,"title",{key:1}):U(a.$slots,"header",{key:0,close:e(R),titleId:e(v),titleClass:e(t).e("title")})]),default:c(()=>[U(a.$slots,"default")]),_:2},[a.$slots.footer?{name:"footer",fn:c(()=>[U(a.$slots,"footer")])}:void 0]),1040,["center","align-center","close-icon","draggable","overflow","fullscreen","header-class","body-class","footer-class","show-close","title","aria-level","onClose"])):B("v-if",!0)]),_:3},8,["trapped","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])],46,["aria-label","aria-labelledby","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["mask","overlay-class","z-index"]),[[Q,e(r)]])]),_:3},8,["onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var Ht=re(Zt,[["__file","dialog.vue"]]);const Jt=We(Ht),Yt={key:1},Qt={__name:"ActionsModal",props:{actionsUrl:String},emits:["close"],setup(o,{emit:g}){const n=o,d=w(!1);let t=Xe({name:"Action",class:"",blueprint:null,dangerous:!1,redirect:!1});w(0);const _=w(),y=w([]),m=w(!1),r=T(()=>({class:t.class,selected:y.value})),v=T(()=>t.dangerous?"danger":"primary"),$=T(()=>t.action_button??"Run Action");Invicta.on("show-action-modal",f=>{console.log("opening the action modal",f);let s=f.selected[0];y.value=f.selected||[],t=f.action,m.value=f.action.blueprint!==null,_.value=`action.${t.class}.${s??t.type}`,d.value=!0}),T(()=>({blueprint:t.blueprint}));const I=()=>{if(m.value)bt(_.value).submit();else{let f={...r.value,fields:[],validation:[]};if(t.redirect){const s=r.value.selected.map(E=>`selected[]=${E}`);let k=`${t.redirect}?class=${r.value.class}&${s.join("&")}`;window.open(k,"_blank")}else Invicta.fetch.post(n.actionsUrl,f).then(({data:s})=>{Invicta.message(s.message),Invicta.emit("refresh-resource")});d.value=!1}},D=()=>{Invicta.emit("refresh-resource"),d.value=!1};return(f,s)=>{const k=fe,E=H,h=Jt;return i(),C(h,{modelValue:e(d),"onUpdate:modelValue":s[1]||(s[1]=R=>et(d)?d.value=R:null),title:e(t).name,width:"30%"},{footer:c(()=>[b(E,{onClick:s[0]||(s[0]=R=>d.value=!1)},{default:c(()=>s[2]||(s[2]=[P("Cancel",-1)])),_:1,__:[2]}),b(E,{type:e(v),onClick:I},{default:c(()=>[P(L(e($)),1)]),_:1},8,["type"])]),default:c(()=>[e(m)?(i(),C(k,{key:e(_),headless:!0,"form-id":e(_),resource:e(t),"action-url":o.actionsUrl,params:e(r),"save-tabs":!1,onSubmitted:D},null,8,["form-id","resource","action-url","params"])):(i(),z("div",Yt,"Are you sure you want to run this action?"))]),_:1},8,["modelValue","title"])}}},Wt={__name:"Actions",props:{name:{type:String,default:"Actions"},global:{type:Boolean,default:!1},actions:Array,selected:{type:Array,default:[]}},setup(o){const g=o,n=d=>{console.log("have command",d);let t={action:d,selected:g.selected.length?g.selected:[]};Invicta.emit("action-called",t)};return(d,t)=>{const _=le,y=H,m=de,r=ue;return i(),C(r,{trigger:"click",onCommand:n,class:"mr-2"},{dropdown:c(()=>[(i(!0),z(W,null,ce(o.actions,v=>(i(),C(m,{command:v},{default:c(()=>[P(L(v.name),1)]),_:2},1032,["command"]))),256))]),default:c(()=>[b(y,{size:"large"},{default:c(()=>[P(L(o.name)+" ",1),b(_,{class:"el-icon--right"},{default:c(()=>[b(e(tt))]),_:1})]),_:1})]),_:1})}}},Xt={class:"mx-2"},eo={__name:"LocaleSwitch",props:{locales:Object},setup(o){const g=o,{locales:n}=g,d=Invicta.getConfig("currentLocale"),t=n[d].hasOwnProperty("flag"),_=y=>{let m=new URL(window.location.href);m.searchParams.set("locale",y),window.location.href=m.toString()};return(y,m)=>{const r=st,v=at,$=H,I=de,D=lt,f=ue;return i(),C(f,{class:"mr-4",onCommand:_},{dropdown:c(()=>[b(D,null,{default:c(()=>[(i(!0),z(W,null,ce(e(n),s=>(i(),C(I,{key:s.iso,command:s.iso,disabled:e(d)==s.iso},{default:c(()=>[P(L(s.name),1)]),_:2},1032,["command","disabled"]))),128))]),_:1})]),default:c(()=>[b($,{size:"small",text:"",type:"info"},{default:c(()=>[b(r,{icon:e(ot),width:15},null,8,["icon"]),m[0]||(m[0]=P()),p("span",Xt,L(e(n)[e(d)].name),1),e(t)?(i(),C(v,{key:0,country:e(n)[e(d)].flag},null,8,["country"])):B("",!0)]),_:1,__:[0]})]),_:1})}}},to={key:0,class:"py-6 px-10"},oo={class:"flex items-end justify-start mb-4"},so={class:"flex-auto mr-4"},ao={class:"mb-1"},lo={class:"max-w-sm"},no={class:"ml-auto flex items-center"},ro={class:"el-card"},io={class:"flex items-center justify-start p-3"},co={class:"mr-2 leading-none"},uo={class:"ml-auto leading-none flex items-center"},fo={key:0,class:"bg-slate-100 px-3 py-2 flex items-center justify-between"},mo={class:"flex items-center leading-none"},po={class:"mr-2 text-sm"},go={class:"ml-auto flex items-center"},vo={class:"ml-3",title:"Delete Selected"},_o={class:"flex items-center justify-between p-3 mt-2"},yo={key:1,class:"p-10 flex items-center justify-center"},ho={class:"px-8 pb-4 pt-12 w-full"},Eo={__name:"IndexBase",props:{handle:String},setup(o){const g=nt(),n=rt(),d=o,t=mt(d.handle);t.initIndex(n);const _=w(),y=w(!1),m=w(),r=w(),v=w(""),$=w({}),I=`api${n.path}/actions`;ie(()=>{Invicta.on("action-called",D)}),it(()=>{Invicta.off("action-called",D)});const D=({action:u,selected:l})=>{if(u.modal)Invicta.emit("show-action-modal",{action:u,selected:l});else{let F=null;$.value={class:u.class},l.length&&($.value.selected=l,F=l[0]),Invicta.fetch.get(`${I}/blueprint/${F}`,{params:{class:u.class}}).then(a=>{m.value=`${d.handle}.${F}.${u.class}`,r.value=a,v.value=I,y.value=!0})}},f=u=>{if(t.static.settings.indexEdit){let l=`api${n.path}/${u}`;$.value={},Invicta.fetch.get(`${l}/edit`).then(F=>{m.value=`${d.handle}.${F.item.id}`,r.value=F,v.value=l,y.value=!0})}else g.push({name:"resourceEdit",params:{handle:d.handle,id:u}})},s=w(!1),k=w([]),E=u=>{s.value=!1,k.value=u.map(l=>l.id)},h=async()=>{let u=await t.selectAll();s.value=!0,k.value=u.data},R=T(()=>`${s.value?t.data.total:k.value.length} records selected`),N=()=>{s.value=!1,_.value.clearSelection(),k.value=[]},V=T(()=>!Ot(t.data.activeFilters)),O=u=>{St.confirm("This action will permanently delete records from database. Are you sure you want to continue?","Deleting",{confirmButtonText:"Delete",cancelButtonText:"Cancel",confirmButtonClass:"el-button--danger"}).then(()=>{Invicta.fetch.delete(`api${n.path}`,{selected:u}).then(l=>{Invicta.message(l.message),t.getResource()})}).catch(l=>{console.log("cancel",l)})},j=()=>{k.value.length&&O(k.value)},x=u=>{u.action=="close"&&(y.value=!1),t.getResource()};return Invicta.on("refresh-resource",()=>{t.getResource()}),(u,l)=>{var X,ee;const F=pt,a=eo,K=Wt,q=H,J=ct("router-link"),S=gt,A=Pt,ve=vt,_e=_t,ye=yt,he=Bt,be=Qt,Ce=fe,we=ut,ke=ht,$e=ft;return i(),z(W,null,[e(t).static.settings?(i(),z("div",to,[p("div",oo,[p("div",so,[p("h1",ao,L(e(t).static.settings.title),1),p("div",lo,[(i(),C(F,{currentSearch:e(n).query.search,key:o.handle,onUpdate:e(t).setSearch},null,8,["currentSearch","onUpdate"]))])]),p("div",no,[e(t).static.settings.locales?(i(),C(a,{key:0,locales:e(t).static.settings.locales},null,8,["locales"])):B("",!0),(X=e(t).static.actions)!=null&&X.global?(i(),C(K,{key:1,global:!0,actions:e(t).static.actions.global,name:"Resource Actions"},null,8,["actions"])):B("",!0),U(u.$slots,"actions",{settings:e(t).static.settings},()=>[G(b(J,{to:{name:"resourceCreate"}},{default:c(()=>[b(q,{type:"primary",size:"large"},{default:c(()=>l[1]||(l[1]=[P("Create new",-1)])),_:1,__:[1]})]),_:1},512),[[Q,e(t).static.settings.canCreate]])])])]),p("div",ro,[p("div",io,[p("div",co,[l[2]||(l[2]=P(" Total: ",-1)),p("strong",null,L(e(t).data.total),1)]),p("div",null,[b(S,{badges:e(t).data.filterBadges},null,8,["badges"])]),p("div",uo,[e(V)?(i(),C(A,{key:0,onClick:e(t).clearFilters,underline:"never",type:"danger",class:"mr-2"},{default:c(()=>l[3]||(l[3]=[P("Clear all filters",-1)])),_:1,__:[3]},8,["onClick"])):B("",!0),e(t).static.filters?(i(),C(ve,{key:1,"resource-handle":o.handle,filters:e(t).static.filters,"active-filters":e(t).data.activeFilters},null,8,["resource-handle","filters","active-filters"])):B("",!0)])]),e(k).length?(i(),z("div",fo,[p("div",mo,[p("span",po,L(e(R)),1),e(s)?B("",!0):(i(),C(A,{key:0,type:"primary",underline:"never",onClick:h,class:"mr-2"},{default:c(()=>[P("Select all "+L(e(t).data.total),1)]),_:1})),b(A,{underline:"never",type:"info",onClick:N},{default:c(()=>l[4]||(l[4]=[P("Deselect all",-1)])),_:1,__:[4]})]),p("div",go,[(ee=e(t).static.actions)!=null&&ee.bulk?(i(),C(K,{key:0,name:"Bulk Actions",actions:e(t).static.actions.bulk,selected:e(k),"selected-all":e(s)},null,8,["actions","selected","selected-all"])):B("",!0),G(p("div",vo,[b(q,{icon:e(dt),onClick:j},null,8,["icon"])],512),[[Q,e(t).static.settings.canDelete]])])])):B("",!0),U(u.$slots,"default",{resource:e(t).data.resourceData,settings:e(t).static.settings,handleEdit:f,handleSelect:E,handleDelete:O},()=>[G((i(),C(_e,{ref_key:"resourceTableRef",ref:_,key:o.handle,"resource-handle":o.handle,data:e(t).data.resourceData,"table-props":e(t).static.settings.table,columns:e(t).static.settings.columns,"can-edit":e(t).static.settings.canEdit,"can-delete":e(t).static.settings.canDelete,"has-detail":e(t).static.settings.hasDetail,onSelect:E,onEdit:f,onDelete:O},null,8,["resource-handle","data","table-props","columns","can-edit","can-delete","has-detail"])),[[$e,e(t).data.loading]])]),p("div",_o,[p("div",null,[l[5]||(l[5]=P(" Total: ",-1)),p("strong",null,L(e(t).data.total),1)]),b(ye,{background:"",size:"small",layout:"jumper, prev, pager, next, sizes","current-page":e(t).data.currentPage,"page-size":e(t).data.perPage,total:e(t).data.total,"onUpdate:pageSize":e(t).setPageSize,"onUpdate:currentPage":e(t).setPage},null,8,["current-page","page-size","total","onUpdate:pageSize","onUpdate:currentPage"])])])])):(i(),z("div",yo,[b(he)])),b(be,{"actions-url":I}),e(y)?(i(),C(ke,{key:2,onClose:l[0]||(l[0]=bo=>y.value=!1),style:{width:"80%"}},{default:c(()=>[b(we,null,{default:c(()=>[p("div",ho,[(i(),C(Ce,{class:"mx-auto",key:e(m),"form-id":e(m),resource:e(r),"action-url":e(v),params:e($),"post-submit-actions":["close","edit"],onSubmitted:x},null,8,["form-id","resource","action-url","params"]))])]),_:1})]),_:1})):B("",!0)],64)}}};export{Eo as _};

import{e as z,b as T}from"./dropdown-menu-BGEQdedM.js";import{g,h as G,o as a,d as r,B as d,a as C,u as t,l as x,F,j as m,U as q,bL as H,t as B,c as w,O as M,b as h,r as P,eS as J,eT as K,eU as Q,G as X,b5 as j,R as Y}from"./main-DL69bNQp.js";import{u as Z,_ as ee}from"./FormBase-C6kPN3Yp.js";import{d as te,_ as ne}from"./vuedraggable.umd-B7QI1GBH.js";import{E as se}from"./link-iUZNf2-L.js";const ie={class:"w-9/12 pt-12 mx-auto"},le={__name:"ItemsForm",props:{requestUrl:String,createWith:Object},emits:["submit"],setup(n,{emit:y}){const e=n,f=y,u=g(null),i=g(null),$=g(0),{createWith:p}=e;G(()=>{Invicta.fetch.get(e.requestUrl).then(l=>{u.value=l,i.value=l.meta.id?`${l.meta.handle}.${l.meta.id}`:`${l.meta.handle}.${$.value}.new`}),$.value++});const k=()=>{if(p){const l=Z(i.value);l.set(p.field,p.value),l.setReadOnly(p.field)}},S=l=>{console.log("we have handle submit in Items Form",l),(l.action=="back"||l.action=="close")&&f("submit")};return(l,b)=>{const D=q,I=ee,E=H;return a(),r(E,null,{default:d(()=>[C("div",ie,[t(u)?(a(),r(I,{key:t(i),"form-id":t(i),resource:t(u),"action-url":t(u).meta.actionUrl,"post-submit-actions":["close","create"],onFormReady:k,onSubmitted:S},{"form-actions":d(()=>[x(D,{class:"ml-auto mr-2",text:"",onClick:b[0]||(b[0]=L=>l.$emit("cancel"))},{default:d(()=>b[1]||(b[1]=[F("Cancel",-1)])),_:1,__:[1]})]),_:1},8,["form-id","resource","action-url"])):m("",!0)])]),_:1})}}},oe={key:1,class:"px-2"},ae={__name:"ItemListItem",props:{item:Object,titleField:String,canEdit:Boolean},setup(n){return(y,e)=>{const f=se;return n.canEdit?(a(),r(f,{key:0,underline:"never",class:"px-2",onClick:e[0]||(e[0]=u=>y.$emit("edit",n.item.id))},{default:d(()=>[F(B(n.item[n.titleField]),1)]),_:1})):(a(),w("div",oe,B(n.item[n.titleField]),1))}}},re={class:"item flex items-center justify-start mb-2 border rounded"},ce={class:"ml-auto flex items-center"},me={key:0,class:"mr-2 text-gray-400"},de={key:1,class:"action-icon",title:"Remove Item"},ue={class:"flex mt-4"},_e={__name:"ItemsList",props:{list:{type:Array,default:[],required:!0},itemsUrl:String,fieldData:Object,resource:String,itemId:Number,sortable:Boolean,editable:{type:Boolean,default:!1},options:{type:Object,default:()=>({addItems:!1,createItems:!0})},select:{type:Array,default:[]},where:String},emits:["updated","form-submitted"],setup(n,{emit:y}){const e=n,f=y,u=`api/resource/${e.resource}`,i=M({state:!1,context:"list"}),$=h(()=>e.options.createItems&&Invicta.can(`create ${e.resource}`)),p=e.editable&&Invicta.can(`edit ${e.resource}`),k="titleField"in e.fieldData?e.fieldData.titleField:"title",S=h(()=>e.fieldData.itemComponent&&Invicta.componentExists(e.fieldData.itemComponent)?e.fieldData.itemComponent:ae),l=h(()=>e.list.map(o=>o.id));function b(o){e.list.splice(e.list.findIndex(s=>s.id==o),1),f("updated",e.list)}const D=o=>{i.state=!1;let s=j(e.list),v=j(o),_=[...s,...v];f("updated",_)},I=g(""),E=o=>{i.context="form",i.state=!0,I.value=`${u}/${o}/edit`},L=()=>{i.context="list",i.state=!0},R=h(()=>{if("createWith"in e.fieldData){let o=e.fieldData.createWith,s=typeof o=="object"?o.field:o,v=e.itemId;return typeof o=="object"&&(v="multiple"in createwith&&o.multiple?[{id:e.itemId}]:{id:e.itemId}),{field:s,value:v}}return null}),O=()=>{i.context="form",i.state=!0,I.value=`${u}/create`};return(o,s)=>{const v=ne,_=Y,U=q,W=z,N=le,A=T;return a(),w(X,null,[x(t(te),{list:n.list,disabled:!n.sortable,animation:150,handle:".drag-handle","item-key":"index",class:"items-stack w-full",onChange:s[0]||(s[0]=c=>o.$emit("updated",n.list))},{item:d(({element:c,index:V})=>[C("div",re,[n.sortable?(a(),r(v,{key:0,class:"text-gray-300 hover:text-gray-400 mr-1"})):m("",!0),(a(),r(P(t(S)),{item:c,index:V,"title-field":t(k),"can-edit":t(p),onEdit:E,class:"ml-1"},null,40,["item","index","title-field","can-edit"])),C("div",ce,[c.locale?(a(),w("span",me,B(c.locale),1)):m("",!0),n.options.addItems?(a(),w("span",de,[x(_,{icon:t(J),onClick:fe=>b(c.id),width:16},null,8,["icon","onClick"])])):m("",!0)])])]),footer:d(()=>[C("div",ue,[t($)?(a(),r(U,{key:0,type:"primary",text:"",bg:"",size:"small",onClick:O},{default:d(()=>[x(_,{icon:t(K),width:15,class:"mr-1"},null,8,["icon"]),s[5]||(s[5]=F(" Create new ",-1))]),_:1,__:[5]})):m("",!0),n.options.addItems?(a(),r(U,{key:1,type:"primary",text:"",bg:"",size:"small",onClick:L},{default:d(()=>[x(_,{icon:t(Q),width:15,class:"mr-1"},null,8,["icon"]),s[6]||(s[6]=F(" Add existing ",-1))]),_:1,__:[6]})):m("",!0)])]),_:1},8,["list","disabled"]),t(i).state?(a(),r(A,{key:0,onClose:s[4]||(s[4]=c=>t(i).state=!1)},{default:d(()=>[t(i).context=="list"?(a(),r(W,{key:0,exclude:t(l),"resource-handle":n.resource,"request-url":n.itemsUrl,"title-field":t(k),select:n.select,where:n.where,onSelected:D,onCancel:s[1]||(s[1]=c=>t(i).state=!1)},null,8,["exclude","resource-handle","request-url","title-field","select","where"])):m("",!0),t(i).context=="form"?(a(),r(N,{key:1,"request-url":t(I),"create-with":t(R),onCancel:s[2]||(s[2]=c=>t(i).state=!1),onSubmit:s[3]||(s[3]=c=>t(i).state=!1)},null,8,["request-url","create-with"])):m("",!0)]),_:1})):m("",!0)],64)}}};export{_e as _};

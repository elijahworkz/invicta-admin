import{m as xe,n as Ee,p as Se,q as Ve,T as X,s as Y,v as ze,x as Ae,g as h,b as N,y as Ne,z as B,A as Te,o as r,d as C,B as c,i as Z,a as m,C as A,u as e,E as R,D as M,r as De,j as I,c as x,F as V,t as z,G as D,l as i,H as Le,I as Ue,J as Oe,K as Fe,L as Be,M as Me,N as Re,O as ee,P as je,Q as Pe,R as te,h as qe,S as He,U as j,V as oe,W as ne,X as Ge,Y as Je,Z as se,$ as le,a0 as ae,w as Ke,a1 as Qe,a2 as We,k as Xe}from"./main-4EO8dEkG.js";import{v as Ye}from"./loading-WRxEvg8b.js";import{_ as Ze,a as et,b as ie,E as tt,c as ot,d as nt,m as st,e as lt}from"./dropdown-menu-kAKyRoI8.js";import{E as at}from"./switch-B1Y4iyL_.js";import{_ as it}from"./AssetForm-BwI6Ulv3.js";import{E as rt}from"./vnode-DGtHscmP.js";import{E as ut}from"./link-BBWfWefN.js";import{d as ct,_ as dt}from"./vuedraggable.umd-COdjr_Pi.js";import"./Loading-BkcZucHr.js";import"./event-BB_Ol6Sd.js";import"./validator-BAgBlLSY.js";const mt=["light","dark"],pt=xe({title:{type:String,default:""},description:{type:String,default:""},type:{type:String,values:Ee(X),default:"info"},closable:{type:Boolean,default:!0},closeText:{type:String,default:""},showIcon:Boolean,center:Boolean,effect:{type:String,values:mt,default:"light"},...Se}),ft={open:()=>!0,close:b=>Ve(b)||b instanceof Event},vt=Y({name:"ElAlert"}),_t=Y({...vt,props:pt,emits:ft,setup(b,{emit:g}){const $=b,{Close:l}=Oe,k=ze(),p=Ae("alert"),v=h(!1),o=N(()=>X[$.type]),t=N(()=>!!($.description||k.default)),d=()=>{v.value=!0,g("open")},E=u=>{v.value=!1,g("close",u)},{onOpen:w,onClose:_}=Ne({showAfter:B($,"showAfter"),hideAfter:B($,"hideAfter"),autoClose:B($,"autoClose"),open:d,close:E});return Te&&w(),(u,f)=>(r(),C(Ue,{name:e(p).b("fade"),persisted:""},{default:c(()=>[Z(m("div",{class:A([e(p).b(),e(p).m(u.type),e(p).is("center",u.center),e(p).is(u.effect)]),role:"alert"},[u.showIcon&&(u.$slots.icon||e(o))?(r(),C(e(R),{key:0,class:A([e(p).e("icon"),{[e(p).is("big")]:e(t)}])},{default:c(()=>[M(u.$slots,"icon",{},()=>[(r(),C(De(e(o))))])]),_:3},8,["class"])):I("v-if",!0),m("div",{class:A(e(p).e("content"))},[u.title||u.$slots.title?(r(),x("span",{key:0,class:A([e(p).e("title"),{"with-description":e(t)}])},[M(u.$slots,"title",{},()=>[V(z(u.title),1)])],2)):I("v-if",!0),e(t)?(r(),x("p",{key:1,class:A(e(p).e("description"))},[M(u.$slots,"default",{},()=>[V(z(u.description),1)])],2)):I("v-if",!0),u.closable?(r(),x(D,{key:2},[u.closeText?(r(),x("div",{key:0,class:A([e(p).e("close-btn"),e(p).is("customed")]),onClick:E},z(u.closeText),3)):(r(),C(e(R),{key:1,class:A(e(p).e("close-btn")),onClick:e(_)},{default:c(()=>[i(e(l))]),_:1},8,["class","onClick"]))],64)):I("v-if",!0)],2)],2),[[Le,v.value]])]),_:3},8,["name"]))}});var gt=Fe(_t,[["__file","alert.vue"]]);const re=Be(gt),bt={class:"mb-4"},yt={key:0,class:"asset-wrap"},ht=["src"],$t={class:"asset-details mr-auto"},Ct={key:2,class:"asset-wrap"},kt={__name:"NavItemIcon",props:Me({disabled:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(b){const g=Re(b,"modelValue"),$=b,l=ee({state:!1,context:"library"}),k=o=>{g.value=o,l.state=!1},p=()=>{$.disabled||(l.context="edit",l.state=!0)},v=()=>{l.context="library",l.state=!0};return(o,t)=>{const d=te,E=Ze,w=et,_=it,u=ie;return r(),x(D,null,[m("div",bt,[t[4]||(t[4]=m("label",{class:"mb-3"},"Icon",-1)),g.value?(r(),x("div",yt,[m("div",{class:"asset",onClick:p},[m("img",{src:g.value.src},null,8,ht)]),m("div",$t,[m("strong",null,z(g.value.name),1)]),m("span",{class:"mr-3 action-icon",onClick:t[0]||(t[0]=f=>g.value=null)},[i(d,{icon:e(je),width:18},null,8,["icon"])])])):b.disabled?b.disabled?(r(),x("div",Ct,"No image")):I("",!0):(r(),C(E,{key:1,type:"browse",onUploadComplete:k,onOpenLibrary:v,single:!0})),t[5]||(t[5]=m("div",{class:"info info-bottom opacity-60 mt-2"},"Add an image to menu item.",-1))]),e(l).state?(r(),C(u,{key:0,onClose:t[3]||(t[3]=f=>e(l).state=!1),style:Pe({width:e(l).context=="library"?"80%":""})},{default:c(()=>[e(l).context=="library"?(r(),C(w,{key:0,onSelected:k,onCancel:t[1]||(t[1]=f=>e(l).state=!1)})):I("",!0),e(l).context=="edit"?(r(),C(_,{key:1,asset:o.fieldValue,onClose:t[2]||(t[2]=f=>e(l).state=!1)},null,8,["asset"])):I("",!0)]),_:1},8,["style"])):I("",!0)],64)}}},wt={class:"p-4 w-full"},It={class:"mb-4 flex items-center justify-between"},xt={key:0,class:"mb-2"},Et={class:"text-right"},St={__name:"NavItemForm",props:{mode:String,itemData:Object},setup(b){const g=b,$=N(()=>g.mode=="create"?"Create Item":"Edit Item"),l=h(g.itemData),k=h(!1),p=h(!1),v=h("");return qe(()=>{if("id"in g.itemData){k.value=!0;let o=`/api/resource/${g.itemData.handle}/${g.itemData.id}/uri`;Invicta.fetch.get(o).then(t=>{t||(p.value=!0,v.value=`${g.itemData.type} not found`),l.value.url=t})}else k.value=!1}),(o,t)=>{const d=j,E=re,w=rt,_=tt,u=kt,f=at,S=ot;return r(),x("div",wt,[m("header",It,[m("h1",null,z(e($)),1),i(d,{icon:e(He),text:"",circle:"",bg:"",onClick:t[0]||(t[0]=y=>o.$emit("close"))},null,8,["icon"])]),e(p)?(r(),x("div",xt,[i(E,{title:e(v),type:"error",effect:"dark","show-icon":"",closable:!1},null,8,["title"])])):I("",!0),i(S,{"label-position":"top",class:"invicta-form"},{default:c(()=>[i(_,{label:"Label"},{default:c(()=>[i(w,{size:"large",modelValue:e(l).label,"onUpdate:modelValue":t[1]||(t[1]=y=>e(l).label=y)},null,8,["modelValue"]),t[8]||(t[8]=m("div",{class:"info info-bottom opacity-60"},"Navigation label.",-1))]),_:1,__:[8]}),i(_,{label:"URL"},{default:c(()=>[i(w,{size:"large",modelValue:e(l).url,"onUpdate:modelValue":t[2]||(t[2]=y=>e(l).url=y),disabled:e(k)},null,8,["modelValue","disabled"]),t[9]||(t[9]=m("div",{class:"info info-bottom opacity-60"},"Leave blank to make simple text item.",-1))]),_:1,__:[9]}),i(u,{modelValue:e(l).icon,"onUpdate:modelValue":t[3]||(t[3]=y=>e(l).icon=y),disabled:!1},null,8,["modelValue"]),i(_,{label:"CSS class"},{default:c(()=>[i(w,{size:"large",modelValue:e(l).css,"onUpdate:modelValue":t[4]||(t[4]=y=>e(l).css=y)},null,8,["modelValue"]),t[10]||(t[10]=m("div",{class:"info info-bottom opacity-60"},"Set custom CSS classes.",-1))]),_:1,__:[10]}),i(_,{label:"Description"},{default:c(()=>[i(w,{size:"large",modelValue:e(l).text,"onUpdate:modelValue":t[5]||(t[5]=y=>e(l).text=y)},null,8,["modelValue"]),t[11]||(t[11]=m("div",{class:"info info-bottom opacity-60"},"Set item description.",-1))]),_:1,__:[11]}),i(_,{label:"Open in new tab"},{default:c(()=>[i(f,{size:"large",modelValue:e(l).external,"onUpdate:modelValue":t[6]||(t[6]=y=>e(l).external=y)},null,8,["modelValue"]),t[12]||(t[12]=m("div",{class:"info info-bottom opacity-60"},"Open link in the new tab.",-1))]),_:1,__:[12]}),m("div",Et,[i(d,{type:"primary",size:"large",onClick:t[7]||(t[7]=y=>o.$emit("saved",e(l)))},{default:c(()=>t[13]||(t[13]=[V("Save Item",-1)])),_:1,__:[13]})])]),_:1})])}}},Vt={class:"ml-auto item-type"},zt={__name:"NavTree",props:{list:Array,childActions:Array},emits:["addChild","editItem","removeItem","change"],setup(b,{emit:g}){const $=b,l=g,k=v=>{v.action=="remove"?($.list.splice(v.item.index,1),l("removeItem",!0)):l("addChild",v)},p=v=>{l("editItem",v)};return(v,o)=>{const t=dt,d=ut,E=nt,w=oe("NavTree",!0);return r(),C(e(ct),{list:b.list,tag:"ul",group:{name:"g1"},animation:150,"item-key":"label",onChange:o[2]||(o[2]=_=>v.$emit("change",!0))},{item:c(({element:_,index:u})=>[m("li",null,[m("div",{class:A(["item flex items-center justify-start border rounded bg-white mb-1 p-2",{error:_.error}])},[i(t,{class:"mr-2 text-gray-300 hover:text-gray-400"}),i(d,{underline:"never",onClick:f=>p(_)},{default:c(()=>[V(z(_.label),1)]),_:2},1032,["onClick"]),m("div",Vt,z(_.error?`${_.type} | Error`:_.type),1),i(E,{actions:b.childActions,item:{index:u,..._},title:"New Child Item",onSelected:k,class:"ml-3"},null,8,["actions","item"])],2),i(w,{list:_.children,"child-actions":b.childActions,onChange:o[0]||(o[0]=f=>v.$emit("change",!0)),onAddChild:k,onEditItem:p,onRemoveItem:o[1]||(o[1]=f=>v.$emit("removeItem",!0))},null,8,["list","child-actions"])])]),_:1},8,["list"])}}},At={class:"ml-2"},Nt={__name:"NavLocalizations",props:{localizations:Object},setup(b){const g=Je(),$=b,l=N(()=>{let{localizations:o}=$;return Object.values(o).filter(t=>t.origin!==null)[0].origin}),k=Object.values($.localizations).filter(o=>o.current)[0].iso,p=o=>o.origin?"Original":o.current?"Current translation":`${o.translation?"Edit":"Create"} ${o.name} translation`,v=o=>{console.log("hadndle command",o);let t=o.translation?o.translation:o.origin?o.origin:null;t?(console.log("do I have the command",t,o),g.replace({name:"navEditItems",params:{id:t},force:!0})):Invicta.fetch.post(`/api/navigation/${l.value}/localize/${o.iso}`).then(d=>{console.log("I have created localized version of this menu",d),g.push({name:"navEditItems",params:{id:d}})})};return(o,t)=>{const d=te,E=j,w=se,_=le,u=ae;return r(),C(u,{class:"mr-4",onCommand:v},{dropdown:c(()=>[i(_,null,{default:c(()=>[(r(!0),x(D,null,ne(b.localizations,f=>(r(),C(w,{key:f.iso,command:f,disabled:f.current,title:p(f)},{default:c(()=>[m("i",{class:A(["icon-status",{success:f.translation||f.origin}])},null,2),t[0]||(t[0]=V()),m("span",At,z(f.name),1)]),_:2,__:[0]},1032,["command","disabled","title"]))),128))]),_:1})]),default:c(()=>[i(E,{size:"small",text:"",type:"info"},{default:c(()=>[i(d,{icon:e(Ge),width:15,class:"mr-2"},null,8,["icon"]),V(" "+z(b.localizations[e(k)].name),1)]),_:1})]),_:1})}}},Tt={class:"py-6 px-10"},Dt={class:"w-2/3 mx-auto"},Lt={class:"flex items-end justify-between mb-4"},Ut={class:"mb-1"},Ot={class:"nav-actions flex items-center"},Ft={key:0,class:"mb-3"},Wt={__name:"NavigationEdit",setup(b){const g=Xe(),$=h(!1),l=h(""),k=h("Menu"),p=h(""),v=h(null),o=h(null),t=h(null),d=ee({state:!1,context:"list"});Ke(()=>g.params.id,E,{immediate:!0});function E(n){$.value=!0,Invicta.fetch.get(`api/navigation/${n}/items`).then(s=>{l.value=s.actionUrl,k.value=s.menuTitle,p.value=s.locale,v.value=s.localizations,t.value=s.tree,o.value=s.resources,$.value=!1})}const w={title:{label:"Title",sortable:!0},locale:{label:"Locale",align:"center"}},_=h(""),u=h(),f=h("link"),S=h(null),y=h(!1),P=N(()=>t.value?q(t.value):!1),ue=N(()=>y.value&&!P.value);function q(n){let s=!1;for(let a of n){if("error"in a){s=!0;break}a.children.length&&(s=q(a.children))}return s}const ce=N(()=>t.value.reduce((n,s)=>(n[s.handle]=n[s.handle]||[],n[s.handle].push(s.id),n),{})),H=(n,s)=>(n.forEach(a=>{a.id==S.value.id&&a.handle==S.value.handle&&a.label==S.value.label?(console.log("debugging items",a.id,S.value.id,a.handle,S.value.handle),a.children.push(...s)):a.children.length&&(console.log("nav items have children"),H(a.children,s))}),n),G=n=>{d.state=!1;let s=n.map(a=>{var U;return{label:a[u.value],url:a==null?void 0:a.url,id:a==null?void 0:a.id,handle:f.value,type:((U=o.value[f.value])==null?void 0:U.title)||(a==null?void 0:a.type),icon:a==null?void 0:a.icon,css:a==null?void 0:a.css,text:a==null?void 0:a.text,external:a==null?void 0:a.external,children:[]}});console.log("something was selected",n,S.value),S.value?t.value=H(t.value,s):t.value=[...t.value,...s],S.value=null,f.value="custom",y.value=!0},O=st(o.value,(n,s)=>({name:n.title,action:s}));O.push({name:"Custom Link",action:"custom",divider:!0}),O.push({name:"Remove Item",action:"remove",danger:!0});const de=n=>{n=="custom"?K():J(n),f.value=n},me=n=>{console.log("adding child",n),S.value=n.item,f.value=n.action,n.action=="custom"?K():J(n.action)};function J(n){d.context="list",u.value=o.value[n].titleField,_.value=`/api/resource/${n}/items`,d.state=!0}const L=h("create"),F=h({}),pe={label:"",url:"",css:"",icon:"",text:"",external:!1},K=()=>{L.value="create",F.value={...pe},d.context="form",d.state=!0},fe=n=>{d.state=!1,u.value="label",n.id||(console.log("check for type",n.url,n.url==""),n.type=n.url==""?"Text":"Link"),L.value=="create"&&G([n]),y.value=!0},ve=n=>{console.log("editing item",n),L.value="edit",F.value=n,d.context="form",d.state=!0},_e=()=>{Invicta.fetch.post(l.value,{tree:t.value}).then(n=>{Invicta.message(n.message)})};return(n,s)=>{const a=R,U=oe("router-link"),Q=j,W=se,ge=le,be=ae,ye=re,he=zt,$e=lt,Ce=St,ke=ie,we=Ye;return r(),x(D,null,[m("div",Tt,[Z((r(),x("div",Dt,[m("div",Lt,[m("div",null,[i(U,{to:{name:"resourceIndex",params:{handle:"navigation"}},class:"breadcrumb"},{default:c(()=>[i(a,null,{default:c(()=>[i(e(Qe))]),_:1}),s[5]||(s[5]=V("Navigation",-1))]),_:1,__:[5]}),m("h1",Ut,z(e(k)),1)]),m("div",Ot,[e(v)?(r(),C(Nt,{key:0,localizations:e(v)},null,8,["localizations"])):I("",!0),i(be,{onCommand:de,class:"mr-2"},{dropdown:c(()=>[i(ge,null,{default:c(()=>[(r(!0),x(D,null,ne(e(o),(T,Ie)=>(r(),C(W,{command:Ie},{default:c(()=>[V(z(T.title),1)]),_:2},1032,["command"]))),256)),i(W,{command:"custom"},{default:c(()=>s[7]||(s[7]=[V("Custom Link",-1)])),_:1,__:[7]})]),_:1})]),default:c(()=>[i(Q,{size:"large"},{default:c(()=>[s[6]||(s[6]=V(" New Item",-1)),i(a,{class:"el-icon--right"},{default:c(()=>[i(e(We))]),_:1})]),_:1,__:[6]})]),_:1}),i(Q,{size:"large",type:"primary",onClick:_e,disabled:!e(ue)},{default:c(()=>s[8]||(s[8]=[V("Save Changes",-1)])),_:1,__:[8]},8,["disabled"])])]),e(P)?(r(),x("div",Ft,[i(ye,{title:"This navigation has errors! Save disabled.",type:"error",effect:"dark","show-icon":"",closable:!1})])):I("",!0),(r(),C(he,{key:e(p),list:e(t),"child-actions":e(O),onAddChild:me,onEditItem:ve,onChange:s[0]||(s[0]=T=>y.value=!0),onRemoveItem:s[1]||(s[1]=T=>y.value=!0)},null,8,["list","child-actions"]))])),[[we,e($)]])]),e(d).state?(r(),C(ke,{key:0,style:{width:"400px"},onClose:s[4]||(s[4]=T=>e(d).state=!1)},{default:c(()=>[e(d).context=="list"?(r(),C($e,{key:0,select:["title","locale"],columns:w,exclude:e(ce)[e(f)],"request-url":e(_),"title-field":e(u),"resource-handle":e(f),onSelected:G,onCancel:s[2]||(s[2]=T=>e(d).state=!1),where:`locale='${e(p)}'`},null,8,["exclude","request-url","title-field","resource-handle","where"])):I("",!0),e(d).context=="form"?(r(),C(Ce,{key:1,mode:e(L),"item-data":e(F),onSaved:fe,onClose:s[3]||(s[3]=T=>e(d).state=!1)},null,8,["mode","item-data"])):I("",!0)]),_:1})):I("",!0)],64)}}};export{Wt as default};

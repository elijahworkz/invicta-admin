import{_}from"./FieldBase-CwnBr57H.js";import{_ as I}from"./ItemsList-D5TZxrTg.js";import{u as b}from"./FormBase-DnoSr6iL.js";import{b as p,o as $,d as v,B as w,l as B,u as n}from"./main-BETf37Wd.js";import"./dropdown-menu-CG9FxyPI.js";import"./Loading-1yvJCY-M.js";import"./event-BB_Ol6Sd.js";import"./vnode-BzGzBTd2.js";import"./field-CO8WPEuf.js";import"./vuedraggable.umd-CO_Qmqgw.js";import"./link-BCwa3b2a.js";import"./isString-lThU85qw.js";import"./card-DN-R5wgT.js";const y={__name:"relatedListField",props:{formId:String,data:Object,path:String},setup(r){const e=r,t=b(e.formId),m=`/api/resource/${t.settings.handle}/relationship/${e.data.id}`,a=e.path.split(".").pop(),d=e.path!==a,f=Invicta.can(`edit ${a}`),l=p(()=>t.get(e.path,!1)),u=p(()=>{let o=t.get(a,[]);return d&&l.value.length?l.value.map(i=>o.find(s=>s.id===i)):o});Invicta.on("resource-form-submitted",h);function c(o){if(d){let i=o.map(s=>s.id);t.set(e.path,i)}t.set(a,o)}function h(){if(console.log("we need to make a call here - where?",t.settings,e.data.id),!t.settings.id)return!1;let o=`/api/resource/${t.settings.handle}/${t.settings.id}/relationship/${e.data.id}`;Invicta.fetch.get(o).then(i=>{console.log("I got this new data here",i),c(i)})}return(o,i)=>{const s=I,g=_;return $(),v(g,{"form-id":r.formId,"field-props":e,class:"related-field"},{default:w(()=>[B(s,{list:n(u),sortable:d,editable:n(f),"items-url":m,"field-data":r.data,resource:n(a),"item-id":n(t).settings.id,options:r.data.options,onUpdated:c},null,8,["list","editable","field-data","resource","item-id","options"])]),_:1},8,["form-id","field-props"])}}};export{y as default};

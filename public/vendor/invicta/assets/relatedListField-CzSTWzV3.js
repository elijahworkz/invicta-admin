import{_}from"./FieldBase-Dq9lo7vr.js";import{_ as I}from"./ItemsList-HRhjDbdy.js";import{u as b}from"./FormBase-CFvT8CJq.js";import{b as p,o as $,d as v,B as w,l as B,u as n}from"./main-BIf-RZjU.js";import"./dropdown-menu-C1dIOVFB.js";import"./Loading-CT6fVT7q.js";import"./event-BB_Ol6Sd.js";import"./vnode-d-qQz3m-.js";import"./field-BinNoQiY.js";import"./vuedraggable.umd-BfC8CmW8.js";import"./link-BI0n2Rx2.js";import"./isString-t2uniiFv.js";import"./card-DaImxt5C.js";const y={__name:"relatedListField",props:{formId:String,data:Object,path:String},setup(r){const e=r,t=b(e.formId),m=`/api/resource/${t.settings.handle}/relationship/${e.data.id}`,a=e.path.split(".").pop(),d=e.path!==a,f=Invicta.can(`edit ${a}`),l=p(()=>t.get(e.path,!1)),u=p(()=>{let o=t.get(a,[]);return d&&l.value.length?l.value.map(i=>o.find(s=>s.id===i)):o});Invicta.on("resource-form-submitted",h);function c(o){if(d){let i=o.map(s=>s.id);t.set(e.path,i)}t.set(a,o)}function h(){if(console.log("we need to make a call here - where?",t.settings,e.data.id),!t.settings.id)return!1;let o=`/api/resource/${t.settings.handle}/${t.settings.id}/relationship/${e.data.id}`;Invicta.fetch.get(o).then(i=>{console.log("I got this new data here",i),c(i)})}return(o,i)=>{const s=I,g=_;return $(),v(g,{"form-id":r.formId,"field-props":e,class:"related-field"},{default:w(()=>[B(s,{list:n(u),sortable:d,editable:n(f),"items-url":m,"field-data":r.data,resource:n(a),"item-id":n(t).settings.id,options:r.data.options,onUpdated:c},null,8,["list","editable","field-data","resource","item-id","options"])]),_:1},8,["form-id","field-props"])}}};export{y as default};

import{_ as R}from"./FieldBase-CwnBr57H.js";import{g as p,b3 as h,h as S,o as f,d as F,B as y,l as x,aP as E,u as i,ag as N,c as P,G as $,W as U}from"./main-BETf37Wd.js";import{m as k,r as j,s as C}from"./dropdown-menu-CG9FxyPI.js";import{u as G}from"./field-CO8WPEuf.js";import{u as K}from"./FormBase-DnoSr6iL.js";import"./Loading-1yvJCY-M.js";import"./event-BB_Ol6Sd.js";import"./vnode-BzGzBTd2.js";import"./isString-lThU85qw.js";import"./card-DN-R5wgT.js";const X={__name:"relatedSelectField",props:{formId:String,data:Object,path:String},setup(u){const t=u,m=p(!1),v=G(t),s=v.value(),B=K(t.formId),d=h(t.data,"titleField","title"),O="props"in t.data?h(t.data.props,"remote",!1):!1,V=`/api/resource/${B.settings.handle}/relationship/${t.data.id}`,r=p([]),_=p([]);S(()=>{if(O)_.value=r.value=k(s.value,e=>({key:e.id,value:{id:e.id,name:e[d]},label:e[d]}));else{let e={title:d};e=b(e),g(e)}});async function w(e){if(e!==""){let a={title:d,search:e};a=b(a),await g(a,!0)}else r.value=[]}function g(e,a=!1){m.value=!0,Invicta.fetch.get(V,{params:e}).then(c=>{let n=k(c,(o,l)=>{let I="path"in t.data?Number(o):{id:Number(o)};return{key:o,value:I,label:l}});a?r.value=[..._.value,...n]:r.value=n,m.value=!1})}function b(e){return t.data.where&&(e.where=t.data.where),t.data.sortBy&&(e.sort_by=t.data.sortBy),t.data.sortOrder&&(e.sort_order=t.data.sortOrder),e}return(e,a)=>{const c=j,n=C,o=R;return f(),F(o,{"form-id":u.formId,"field-props":t,class:"related-field"},{default:y(()=>[x(n,E({modelValue:i(s),"onUpdate:modelValue":a[0]||(a[0]=l=>N(s)?s.value=l:null),valueKey:"id","remote-method":w,loading:i(m),teleported:!1,disabled:i(v).disabled},u.data.props),{default:y(()=>[(f(!0),P($,null,U(i(r),l=>(f(),F(c,{key:l.key,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},16,["modelValue","loading","disabled"])]),_:1},8,["form-id","field-props"])}}};export{X as default};
